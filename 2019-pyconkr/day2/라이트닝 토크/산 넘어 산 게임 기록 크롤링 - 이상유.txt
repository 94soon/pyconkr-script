다음은 이상유 님께서 산넘어산 게임기록 크롤링 발표 진행해주시겠습니다. 박수 부탁드립니다.

(박수)

-어..... 아... 이렇게 많은 사람들 앞에서 하는 거 첫 발표인데 정말 떨리네요, 이거...

산넘어산, 게임기록 크롤링이라는 주제로 라이트닝토크 진행하게 된 이상유입니다.

(박수)

이 게임이 무슨 게임이냐 하면 아시는 분들은 아실 거예요. 

오락실에서 볼 수 있는 유비트라는 게임인데 이 시국에 일본 게임 다루고 있습니다. (웃음)

가벼운 마음으로 시작했어요, 처음에는. 

사실 입시 준비하면서 공부하기 정말 싫어서 했어요.

개발 시작 당시에 국내하고 일본 합쳐서 유사 서비스가 3개 있었어요.

그런데 이 두 웹사이트 모두 PC용 인터페이스만 제공을 해서

반응형 UX를 제공하는 사이트를 만들어보자는 의도로 네명 팀에 한 명 디자인, 세 명 개발하는 팀으로 진행을 하게 됐습니다.

저는 백엔드하고 업데이터쪽 전반을 담당을 했고요.

가벼운 마음으로 시작을 했는데 이제 원클릭 업데이트를 구현을 하려고 했어요, 처음에는.

구현이 됐고요.

이게 한국쪽 웹사이트에서는 지금 저희 말고 다른 웹사이트에서 먼저 만들었던 기능인데 다른 더 옛날 방식을 쓰게 되면

 브라우저에 자바를 등록해놓고 그 게임사 사이트에 가서 그 자바 스크립트를 눌러서 직접 로그인 토큰을 날려줘야 되는 거예요. 귀찮잖아요.

그래서 한번 딱 누르면 업데이트가 될 수 있게 하기 위해서 개발을 시작했는데 따단!

캡차가 있었습니다.

다행인 건 이미지 이름 자체는 리퀘스트마다 바뀌어요. 

그런데 얘네가 리퀘스트마다 이미지 별도 처리는 하지 않더라고요.

 그래서 여기에 노이즈를 섞지도 않고 해서 어떻게 해쉬가 바뀌게 하지 않아서 
 
 이 앞에 슬라이드처럼 기본자세 하나에 저 밑에 표현이 들어가는 자세가 캐릭터마다 5개씩 있는데 30개죠.
 
  30개 다 이미지 따서 해쉬 값을 그냥 코드에 박아넣었습니다.

이러고 나서 이걸 로그인을 해결하니까 업데이터는 일단 구현을 했어요. 너무 느려요.

한번 긁는 데 최소 350.

보통 이 사이트를 사용하시는 유저층들이 어느 정도 게임에 관심을 가지고 기록을 좀 관리하시려는 분들이 저걸 사용하시다 보니까 보통 700p 이상을 긁어야 됩니다.

싱글스레드로 하면 2분 정도 걸립니다.

그래서 이런 구조를 만들었는데요. 업데이트 리퀘스트가 들어오게 되면 프로파일, 한 페이지예요. 이거 그냥 긁고요.

일단 플레이데이터가 총 몇 페이지 있는지 확인하고 각 페이지별로 워커를 줘서 분산처리를 하게 됩니다.

또 그게 없는 경우가 있어요. 곡이 새로운 곡이 추가가 된 경우인데 그것도 그러면 한번 싹 추가해서 호출하게 됩니다.

그래서 http 리퀘스트하는 쪽은 멀티프로세싱, 아니면 스레딩을 써서 하고 플레이 기록이 있는 곡만 가져오도록.

얘네가 기록이 없으면 하이픈으로 처리를 해요. 

그래서 이렇게 수정하니까 2, 30초 정도 걸립니다. 많이 빨라졌죠.

여러 업데이터를 연결하려고 했어요.

브로커가 하나 있고 아무런 전처리 없이 추가할 수 있게, 그리고 방화벽 정책을 못 건드려도 할 수 있게.

하니까 API 서버 있고 업데이터 브로커를 두고 거기에 또 업데이터를 연결해야 하고 

최대한 즉시 업데이트를 시작하기 위해서 웹소켓을 사용을 했습니다. 

DB도 터널링을 써서 하려고 했었는데 연결이 불안정하니까 계속 튕기더라고요.

그래서 그냥 완전히 Http로 만들어서 붙여버렸습니다.

하니까 이제 이런 식으로 처음에 만들어서 서비스를 하게 됐고 

뭐 잘 돌아가는 것처럼 보였고 지금도 조금씩 회원수가 늘고 있어서 다행이라고 생각하는데요. 

문제가 이거 고2 때 처음 시작한 프로젝트이고 제가 지금 대학교 1학년이에요. 

주석 안 달았고요. 하도 기워대니까 이게 저도 이해를 못하겠어요, 이제.

처음에는 크롤러가 저 서버 쪽에 직접 브로커가 있는 쪽에 직접 들어가 있는 형태였기 때문에 MySQL로 정보를 받아옵니다.

그런데 이게 도커에서 퍼포먼스 낮은 데 들어가니까 램이 달려서 튕겨요.

가끔 과도한 접속으로 차단됩니다.

그래서 그냥 싹 갈아엎고 있습니다. 

워커를 지금 브로커에서 분산처리를 하고 있고요.

API가 검색계통에 일라스틱서치를 하려고 하고 있습니다. 

옛말에 틀린 말이 하나 없습니다. 정말 머리나쁘니까 몸이 엄청 고생합니다.

이거 진리입니다. (웃음)

(박수)

-(사회자) 엄청 떨리셨다고 하는데 저는 아까 도미솔 할 때 살짝 토할 뻔 했고요. (웃음)
